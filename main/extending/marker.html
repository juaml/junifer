<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="7.4. Adding Parcellations" href="parcellations.html" /><link rel="prev" title="7.2. Creating Data Grabbers" href="datagrabber.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>7.3. Creating Markers - junifer documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">junifer  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/junifer_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">junifer  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">1. Installing junifer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#installing-external-dependencies">2. Installing external dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting.html">3. First steps with junifer</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../understanding/index.html">4. Understanding junifer</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../understanding/pipeline.html">4.1. The junifer Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/data.html">4.2. The Data Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/datagrabber.html">4.3. Data Grabber</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/datareader.html">4.4. Data Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/preprocess.html">4.5. Preprocess</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/marker.html">4.6. Marker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/storage.html">4.7. Storage</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../using/index.html">5. Using junifer</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../using/codeless.html">5.1. Code-less Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/running.html">5.2. Running Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/running.html#collecting-results">5.3. Collecting Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/queueing.html">5.4. Queueing Jobs (HPC, HTC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/masks.html">5.5.1. Masks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../builtin.html">6. Built-in Pipeline Components</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">7. Extending junifer</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="extension.html">7.1. Creating a junifer extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="datagrabber.html">7.2. Creating Data Grabbers</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">7.3. Creating Markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="parcellations.html">7.4. Adding Parcellations</a></li>
<li class="toctree-l2"><a class="reference internal" href="coordinates.html">7.5. Adding Coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="masks.html">7.6. Adding Masks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_examples/index.html">8. Examples</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/run_datagrabber_bids_datalad.html">8.1. Generic BIDS datagrabber for datalad.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/norun_ukbvm_gmd.html">8.2. UKB VBM GMD Extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/run_compute_parcel_mean.html">8.3. Computer Parcel Aggregation.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/run_run_gmd_mean.html">8.4. UKB VBM GMD Extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/run_ets_rss_marker.html">8.5. Extracting root sum of squares from edge-wise timeseries.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/norun_hcpfc_pearson.html">8.6. HCP FC Extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/run_junifer_julearn.html">8.7. Run junifer and julearn.</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">9. API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/datagrabbers.html">9.1.1. Data Grabbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datareaders.html">9.1.2. DataReaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/preprocessing.html">9.1.3. Pre-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/markers.html">9.1.4. Markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/storage.html">9.1.5. Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/data.html">9.2.1. Parcellations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/data.html#module-junifer.data.coordinates">9.2.2. Coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/data.html#module-junifer.data.masks">9.2.3. Masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/stats.html">9.2.4. Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pipeline.html">9.2.5. Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pipeline.html#module-junifer.pipeline.registry">9.2.6. Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/api.html">9.2.7. API Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/utils.html">9.2.8. Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/testing.html">9.2.9. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/configs.html">9.3.1. Configs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/nilearn.html">9.4.1. Nilearn</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">10. Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">11. Contributing to junifer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintaining.html">12. Maintaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">13. FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">14. What’s new</a></li>
</ul>

</div>
<div class="sidebar-tree">
  <p class="version-select">
    <span class="caption-text">Other Versions</span>
  </p> 
  <div id="versions">
    
    <span class="caption-text">Branches</span>
    <ul>
      <li><a class="reference internal" href="marker.html">main</a></li>
    </ul>
    
    
    <span class="caption-text">Tags</span>
    <ul>
      <li><a class="reference internal" href="../../v0.0.1/extending/marker.html">v0.0.1</a></li>
      <li><a class="reference internal" href="../../v0.0.2/extending/marker.html">v0.0.2</a></li>
    </ul>
    
  </div>
</div>

</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="creating-markers">
<span id="extending-markers"></span><h1><span class="section-number">7.3. </span>Creating Markers<a class="headerlink" href="#creating-markers" title="Permalink to this heading">#</a></h1>
<p>Computing a marker (a.k.a. <em>feature</em>) is the main goal of junifer. While we aim
to provide as many markers as possible, it might be the case that the marker you
are looking for is not available. In this case, you can create your own marker
by following this tutorial.</p>
<p>Most of the functionality of a junifer marker has been taken care by the
<a class="reference internal" href="../api/markers.html#junifer.markers.BaseMarker" title="junifer.markers.BaseMarker"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseMarker</span></code></a> class. Thus, only a few methods are required:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_valid_inputs</span></code>: The method to obtain the list of valid inputs for the
marker. This is used to check that the inputs provided by the user are
valid. This method should return a list of strings, representing
<a class="reference internal" href="../understanding/data.html#data-types"><span class="std std-ref">data types</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_output_type</span></code>: The method to obtain the kind of output of the marker.
This is used to check that the output of the marker is compatible with the
storage. This method should return a string, representing
<a class="reference internal" href="../understanding/storage.html#storage-types"><span class="std std-ref">storage types</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compute</span></code>: The method that given the data, computes the marker.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code>: The initialisation method, where the marker is configured.</p></li>
</ol>
<p>As an example, we will develop a <code class="docutils literal notranslate"><span class="pre">ParcelMean</span></code> marker, a marker that first
applies a parcellation and then computes the mean of the data in each parcel.
This is a very simple example, but it will show you how to create a new marker.</p>
<section id="step-1-configure-input-and-output">
<span id="extending-markers-input-output"></span><h2><span class="section-number">7.3.1. </span>Step 1: Configure input and output<a class="headerlink" href="#step-1-configure-input-and-output" title="Permalink to this heading">#</a></h2>
<p>This step is quite simple: we need to define the input and output of the marker.
Based on the current <a class="reference internal" href="../understanding/data.html#data-types"><span class="std std-ref">data types</span></a>, we can have <code class="docutils literal notranslate"><span class="pre">BOLD</span></code>,
<code class="docutils literal notranslate"><span class="pre">VBM_WM</span></code> and <code class="docutils literal notranslate"><span class="pre">VBM_GM</span></code> as valid inputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_valid_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;BOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;VBM_WM&quot;</span><span class="p">,</span> <span class="s2">&quot;VBM_GM&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The output of the marker depends on the input. For <code class="docutils literal notranslate"><span class="pre">BOLD</span></code>, it will be
<code class="docutils literal notranslate"><span class="pre">timeseries</span></code>, while for the rest of the inputs, it will be <code class="docutils literal notranslate"><span class="pre">vector</span></code>. Thus,
we can define the output as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">input_kind</span> <span class="o">==</span> <span class="s2">&quot;BOLD&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;timeseries&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;vector&quot;</span>
</pre></div>
</div>
</section>
<section id="step-2-initialise-the-marker">
<span id="extending-markers-init"></span><h2><span class="section-number">7.3.2. </span>Step 2: Initialise the marker<a class="headerlink" href="#step-2-initialise-the-marker" title="Permalink to this heading">#</a></h2>
<p>In this step we need to define the parameters of the marker the user can provide
to configure how the marker will behave.</p>
<p>The parameters of the marker are defined in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. The
<a class="reference internal" href="../api/markers.html#junifer.markers.BaseMarker" title="junifer.markers.BaseMarker"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseMarker</span></code></a> class requires two optional parameters:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the marker. This is used to identify the marker in the
configuration file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code>: a list or string with the data types that the marker will be applied
to.</p></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Only basic types (<em>int</em>, <em>bool</em> and <em>str</em>), lists, tuples and dictionaries
are allowed as parameters. This is because the parameters are stored in
JSON format, and JSON only supports these types.</p>
</div>
<p>In this example, only paramater required for the computation is the name of the
parcellation to use. Thus, we can define the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
   <span class="bp">self</span><span class="p">,</span>
   <span class="n">parcellation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
   <span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parcellation</span> <span class="o">=</span> <span class="n">parcellation</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Parameters of the marker must be stored as object attributes without using
<code class="docutils literal notranslate"><span class="pre">_</span></code> as prefix. This is because any attribute that starts with <code class="docutils literal notranslate"><span class="pre">_</span></code> will
not be considered as a parameter and not stored as part of the metadata of
the marker.</p>
</div>
</section>
<section id="step-3-compute-the-marker">
<span id="extending-markers-compute"></span><h2><span class="section-number">7.3.3. </span>Step 3: Compute the marker<a class="headerlink" href="#step-3-compute-the-marker" title="Permalink to this heading">#</a></h2>
<p>In this step, we will define the method that computes the marker. This method
will be called by junifer when needed, using the data provided by the
datagrabber, as configured by the user. The method <code class="docutils literal notranslate"><span class="pre">compute</span></code> has two
arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: a dictionary with the data to be used to compute the marker. This
will be the corresponding element in the <a class="reference internal" href="../understanding/data.html#data-object"><span class="std std-ref">Data Object</span></a>
alredy indexed. Thus, the dictionary has at least two keys: <code class="docutils literal notranslate"><span class="pre">data</span></code> and
<code class="docutils literal notranslate"><span class="pre">path</span></code>. The first one contains the data, while the second one contains the
path to the data. The dictionary can also contain other keys, depending on the
data type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extra_input</span></code>: the rest of the <a class="reference internal" href="../understanding/data.html#data-object"><span class="std std-ref">Data Object</span></a>. This is
useful if you want to use other data to compute the marker
(e.g.: <code class="docutils literal notranslate"><span class="pre">BOLD_confounds</span></code> can be used to de-confound the <code class="docutils literal notranslate"><span class="pre">BOLD</span></code> data).</p></li>
</ul>
<p>Following the example, we will compute the mean of the data in each parcel using
<a class="reference external" href="https://nilearn.github.io/stable/modules/generated/nilearn.maskers.NiftiLabelsMasker.html#nilearn.maskers.NiftiLabelsMasker" title="(in Nilearn)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nilearn.maskers.NiftiLabelsMasker</span></code></a>. Importantly, the output of the
compute function must be a dictionary. This dictionary will later be passed onto
the <code class="docutils literal notranslate"><span class="pre">store</span></code> method.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>To simplify the <code class="docutils literal notranslate"><span class="pre">store</span></code> method, define keys of the dictionary based on the
corresponding store functions in the <a class="reference internal" href="../understanding/storage.html#storage-types"><span class="std std-ref">storage types</span></a>.
For example, if the output is a <code class="docutils literal notranslate"><span class="pre">vector</span></code>, the keys of the dictionary should
be <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">col_names</span></code>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">junifer.data</span> <span class="kn">import</span> <span class="n">load_parcellation</span>
<span class="kn">from</span> <span class="nn">nilearn.maskers</span> <span class="kn">import</span> <span class="n">NiftiLabelsMasker</span>


<span class="k">def</span> <span class="nf">compute</span><span class="p">(</span>
   <span class="bp">self</span><span class="p">,</span>
   <span class="nb">input</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
   <span class="n">extra_input</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="c1"># Get the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="c1"># Get the min of the voxels sizes and use it as the resolution</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get_zooms</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Load the parcellation</span>
    <span class="n">t_parcellation</span><span class="p">,</span> <span class="n">t_labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_parcellation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parcellation_name</span><span class="p">,</span>
        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create a masker</span>
    <span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiLabelsMasker</span><span class="p">(</span>
        <span class="n">labels_img</span><span class="o">=</span><span class="n">t_parcellation</span><span class="p">,</span>
        <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;nilearn_cache&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># mask the data</span>
    <span class="n">out_values</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>

    <span class="c1"># Create the output dictionary</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">out_values</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="n">t_labels</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</section>
<section id="step-4-finalise-the-marker">
<span id="extending-markers-finalize"></span><h2><span class="section-number">7.3.4. </span>Step 4: Finalise the marker<a class="headerlink" href="#step-4-finalise-the-marker" title="Permalink to this heading">#</a></h2>
<p>Once all of the above steps are done, we just need to give our marker a name,
state its <em>dependencies</em> and register it using the <code class="docutils literal notranslate"><span class="pre">&#64;register_marker</span></code>
decorator.</p>
<p>The <em>dependencies</em> are the core packages that are required to compute the marker.
This will be later used to keep track of the versions of the packages used to
compute the marker. To inform junifer about the dependencies of a marker, we need
to define a <code class="docutils literal notranslate"><span class="pre">_DEPENDENCIES</span></code> attribute in the class. This attribute must be a
set, with the names of the packages as strings. For example, the <code class="docutils literal notranslate"><span class="pre">ParcelMean</span></code>
marker has the following dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nilearn&quot;</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally, we need to register the marker using the <code class="docutils literal notranslate"><span class="pre">&#64;register_marker</span></code> decorator.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">junifer.api.decorators</span> <span class="kn">import</span> <span class="n">register_marker</span>
<span class="kn">from</span> <span class="nn">junifer.data</span> <span class="kn">import</span> <span class="n">load_parcellation</span>
<span class="kn">from</span> <span class="nn">junifer.markers.base</span> <span class="kn">import</span> <span class="n">BaseMarker</span>
<span class="kn">from</span> <span class="nn">nilearn.maskers</span> <span class="kn">import</span> <span class="n">NiftiLabelsMasker</span>


<span class="nd">@register_marker</span>
<span class="k">class</span> <span class="nc">ParcelMean</span><span class="p">(</span><span class="n">BaseMarker</span><span class="p">):</span>

    <span class="n">_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nilearn&quot;</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
       <span class="bp">self</span><span class="p">,</span>
       <span class="n">parcellation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
       <span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
       <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parcellation</span> <span class="o">=</span> <span class="n">parcellation</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_valid_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;BOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;VBM_WM&quot;</span><span class="p">,</span> <span class="s2">&quot;VBM_GM&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_kind</span> <span class="o">==</span> <span class="s2">&quot;BOLD&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;timeseries&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;vector&quot;</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span>
       <span class="bp">self</span><span class="p">,</span>
       <span class="nb">input</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
       <span class="n">extra_input</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># Get the data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

        <span class="c1"># Get the min of the voxels sizes and use it as the resolution</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get_zooms</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1"># Load the parcellation</span>
        <span class="n">t_parcellation</span><span class="p">,</span> <span class="n">t_labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_parcellation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parcellation_name</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create a masker</span>
        <span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiLabelsMasker</span><span class="p">(</span>
            <span class="n">labels_img</span><span class="o">=</span><span class="n">t_parcellation</span><span class="p">,</span>
            <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;nilearn_cache&quot;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># mask the data</span>
        <span class="n">out_values</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>

        <span class="c1"># Create the output dictionary</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">out_values</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="n">t_labels</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</section>
<section id="template-for-a-custom-marker">
<span id="extending-markers-template"></span><h2><span class="section-number">7.3.5. </span>Template for a custom Marker<a class="headerlink" href="#template-for-a-custom-marker" title="Permalink to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">junifer.api.decorators</span> <span class="kn">import</span> <span class="n">register_marker</span>
<span class="kn">from</span> <span class="nn">junifer.markers</span> <span class="kn">import</span> <span class="n">BaseMarker</span>


<span class="nd">@register_marker</span>
<span class="k">class</span> <span class="nc">TemplateMarker</span><span class="p">(</span><span class="n">BaseMarker</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># TODO: add marker-specific parameters</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_valid_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: Complete with the valid inputs</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">valid</span>

    <span class="k">def</span> <span class="nf">get_output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_kind</span><span class="p">):</span>
        <span class="c1"># TODO: Return the valid output kind for each input kind</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">extra_input</span><span class="p">):</span>
        <span class="c1"># TODO: compute the marker and create the output dictionary</span>

        <span class="c1"># Create the output dictionary</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="parcellations.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">7.4. </span>Adding Parcellations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="datagrabber.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">7.2. </span>Creating Data Grabbers</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Authors of junifer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">7.3. Creating Markers</a><ul>
<li><a class="reference internal" href="#step-1-configure-input-and-output">7.3.1. Step 1: Configure input and output</a></li>
<li><a class="reference internal" href="#step-2-initialise-the-marker">7.3.2. Step 2: Initialise the marker</a></li>
<li><a class="reference internal" href="#step-3-compute-the-marker">7.3.3. Step 3: Compute the marker</a></li>
<li><a class="reference internal" href="#step-4-finalise-the-marker">7.3.4. Step 4: Finalise the marker</a></li>
<li><a class="reference internal" href="#template-for-a-custom-marker">7.3.5. Template for a custom Marker</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../_static/js/custom.js"></script>
    </body>
</html>